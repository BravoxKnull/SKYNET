<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKYNET - Profile</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <img src="logo.png" alt="SKYNET Logo" class="logo">
                <h1>SKYNET</h1>
            </div>
            <nav class="nav-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i> Home
                </a>
                <button id="logoutBtn" class="nav-link">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </nav>
        </header>

        <!-- Profile Section -->
        <main class="profile-container">
            <div class="profile-card">
                <h2>Profile Settings</h2>
                <form id="profileForm" class="profile-form">
                    <div class="avatar-section">
                        <div class="avatar-preview">
                            <img id="avatarPreview" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNjY2IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PGNpcmNsZSBjeD0iMTIiIGN5PSI4IiByPSI1Ii8+PHBhdGggZD0iTTIwIDIxYTggOCAwIDAgMC0xNiAwIi8+PC9zdmc+" alt="Avatar Preview">
                        </div>
                        <div class="avatar-upload">
                            <label for="avatar" class="upload-btn">
                                <i class="fas fa-camera"></i> Change Avatar
                            </label>
                            <input type="file" id="avatar" accept="image/*" style="display: none;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="displayName">Display Name</label>
                        <input type="text" id="displayName" required>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="save-btn">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>

                    <div id="successMessage" class="success-message" style="display: none;"></div>
                </form>
            </div>
        </main>
    </div>

    <script>
        // Get user data from localStorage
        const user = JSON.parse(localStorage.getItem('user'))
        if (!user) {
            window.location.href = 'auth.html'
        }

        // Set current values
        document.getElementById('displayName').value = user.displayName
        if (user.avatar_url) {
            document.getElementById('avatarPreview').src = user.avatar_url
        }

        // Handle form submission
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault()
            
            const displayName = document.getElementById('displayName').value
            const avatarFile = document.getElementById('avatar').files[0]
            
            try {
                let avatar_url = user.avatar_url
                
                // If new avatar is selected, upload it
                if (avatarFile) {
                    const formData = new FormData()
                    formData.append('avatar', avatarFile)
                    
                    const response = await fetch('/upload-avatar', {
                        method: 'POST',
                        body: formData
                    })
                    
                    if (!response.ok) {
                        throw new Error('Failed to upload avatar')
                    }
                    
                    const data = await response.json()
                    avatar_url = data.avatar_url
                }
                
                // Update user data
                const updatedUser = {
                    ...user,
                    displayName,
                    avatar_url
                }
                
                // Save to localStorage
                localStorage.setItem('user', JSON.stringify(updatedUser))
                
                // Show success message
                const successMessage = document.getElementById('successMessage')
                successMessage.textContent = 'Profile updated successfully!'
                successMessage.style.display = 'block'
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    successMessage.style.display = 'none'
                }, 3000)
                
            } catch (error) {
                console.error('Error updating profile:', error)
                alert('Failed to update profile. Please try again.')
            }
        })

        // Preview avatar before upload
        document.getElementById('avatar').addEventListener('change', (e) => {
            const file = e.target.files[0]
            if (file) {
                const reader = new FileReader()
                reader.onload = (e) => {
                    document.getElementById('avatarPreview').src = e.target.result
                }
                reader.readAsDataURL(file)
            }
        })

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('user')
            window.location.href = 'auth.html'
        })
    </script>
</body>
</html> 